<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³è¾“å…¥åŠ©æ‰‹æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }

        .test-section h3 {
            color: #4285f4;
            margin-top: 0;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        input[type="text"],
        input[type="email"],
        input[type="search"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="search"]:focus,
        textarea:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .contenteditable {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 12px;
            min-height: 100px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .contenteditable:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status.success {
            background: #e6f4ea;
            color: #137333;
            border: 1px solid #34a853;
        }

        .status.info {
            background: #e8f0fe;
            color: #1967d2;
            border: 1px solid #4285f4;
        }

        .status.warning {
            background: #fef7e0;
            color: #ea8600;
            border: 1px solid #fbbc04;
        }

        .instructions {
            background: #f8f9fa;
            border-left: 4px solid #4285f4;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }

        .instructions h3 {
            margin-top: 0;
            color: #4285f4;
        }

        .instructions ol {
            margin: 0;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .feature-card h4 {
            color: #4285f4;
            margin-bottom: 10px;
        }

        .test-button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background 0.3s ease;
        }

        .test-button:hover {
            background: #3367d6;
        }

        .console-output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ è¯­éŸ³è¾“å…¥åŠ©æ‰‹æµ‹è¯•é¡µé¢</h1>

        <div class="status info">
            ğŸ’¡ è¯·ç¡®ä¿å·²å®‰è£…è¯­éŸ³è¾“å…¥åŠ©æ‰‹æ‰©å±•ï¼Œå¹¶åœ¨æ‰©å±•é…ç½®ä¸­è®¾ç½®äº†APIå¯†é’¥
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤ï¼š</h3>
            <ol>
                <li>ç‚¹å‡»ä¸‹é¢çš„ä»»æ„è¾“å…¥æ¡†ï¼Œä½¿å…¶è·å¾—ç„¦ç‚¹</li>
                <li>è§‚å¯Ÿè¾“å…¥æ¡†å³ä¾§æ˜¯å¦å‡ºç°éº¦å…‹é£å›¾æ ‡ ğŸ¤</li>
                <li>ç‚¹å‡»éº¦å…‹é£å›¾æ ‡å¼€å§‹å½•éŸ³</li>
                <li>å¯¹ç€éº¦å…‹é£è¯´è¯ï¼Œè§‚å¯Ÿè¯†åˆ«ç»“æœ</li>
                <li>å†æ¬¡ç‚¹å‡»éº¦å…‹é£å›¾æ ‡åœæ­¢å½•éŸ³</li>
            </ol>
        </div>

        <div class="feature-grid">
            <div class="feature-card">
                <h4>ğŸ¯ æ™ºèƒ½æ£€æµ‹</h4>
                <p>è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰ç±»å‹çš„è¾“å…¥æ¡†</p>
            </div>
            <div class="feature-card">
                <h4>âš¡ å®æ—¶è¯†åˆ«</h4>
                <p>è¯­éŸ³è½¬æ–‡å­—ï¼Œå®æ—¶æ˜¾ç¤ºç»“æœ</p>
            </div>
            <div class="feature-card">
                <h4>ğŸ”’ å®‰å…¨å­˜å‚¨</h4>
                <p>APIå¯†é’¥æœ¬åœ°åŠ å¯†å­˜å‚¨</p>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ§ª è¾“å…¥æ¡†æµ‹è¯•åŒºåŸŸ</h2>

        <div class="test-section">
            <h3>å•è¡Œæ–‡æœ¬è¾“å…¥æ¡† (input[type="text"])</h3>
            <div class="form-group">
                <label for="text1">å§“åï¼š</label>
                <input type="text" id="text1" placeholder="ç‚¹å‡»è¿™é‡Œï¼Œç„¶åç‚¹å‡»éº¦å…‹é£å›¾æ ‡å¼€å§‹è¯­éŸ³è¾“å…¥">
            </div>
            <div class="form-group">
                <label for="text2">åœ°å€ï¼š</label>
                <input type="text" id="text2" placeholder="è¯•è¯•è¯´ä¸€ä¸ªåœ°å€">
            </div>
        </div>

        <div class="test-section">
            <h3>é‚®ç®±è¾“å…¥æ¡† (input[type="email"])</h3>
            <div class="form-group">
                <label for="email1">é‚®ç®±åœ°å€ï¼š</label>
                <input type="email" id="email1" placeholder="è¯•è¯•è¯´ä¸€ä¸ªé‚®ç®±åœ°å€">
            </div>
        </div>

        <div class="test-section">
            <h3>æœç´¢è¾“å…¥æ¡† (input[type="search"])</h3>
            <div class="form-group">
                <label for="search1">æœç´¢å†…å®¹ï¼š</label>
                <input type="search" id="search1" placeholder="è¯•è¯•è¯´ä¸€ä¸ªæœç´¢å…³é”®è¯">
            </div>
        </div>

        <div class="test-section">
            <h3>å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡† (textarea)</h3>
            <div class="form-group">
                <label for="textarea1">ç•™è¨€å†…å®¹ï¼š</label>
                <textarea id="textarea1" placeholder="è¯•è¯•è¯´ä¸€æ®µè¾ƒé•¿çš„æ–‡å­—ï¼Œæ¯”å¦‚è‡ªæˆ‘ä»‹ç»æˆ–ä¸€æ®µæè¿°"></textarea>
            </div>
        </div>

        <div class="test-section">
            <h3>å¯Œæ–‡æœ¬ç¼–è¾‘æ¡† (contenteditable)</h3>
            <div class="form-group">
                <label for="contenteditable1">å¯Œæ–‡æœ¬å†…å®¹ï¼š</label>
                <div id="contenteditable1" class="contenteditable" contenteditable="true">
                    ç‚¹å‡»è¿™é‡Œå¼€å§‹ç¼–è¾‘ï¼Œè¯•è¯•è¯­éŸ³è¾“å…¥åŠŸèƒ½...
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ”§ è°ƒè¯•å·¥å…·</h2>

        <div class="test-section">
            <h3>æ‰©å±•çŠ¶æ€æ£€æµ‹</h3>
            <button class="test-button" onclick="checkExtension()">æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
            <button class="test-button" onclick="checkPermissions()">æ£€æŸ¥æƒé™</button>
            <button class="test-button" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
            <div id="console-output" class="console-output">
                æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
            </div>
        </div>

        <div class="test-section">
            <h3>æ¨¡æ‹Ÿæµ‹è¯•</h3>
            <button class="test-button" onclick="simulateFocus()">æ¨¡æ‹Ÿè¾“å…¥æ¡†ç„¦ç‚¹</button>
            <button class="test-button" onclick="simulateBlur()">æ¨¡æ‹Ÿè¾“å…¥æ¡†å¤±ç„¦</button>
            <button class="test-button" onclick="testAllInputs()">æµ‹è¯•æ‰€æœ‰è¾“å…¥æ¡†</button>
        </div>
    </div>

    <script>
        // æ§åˆ¶å°è¾“å‡ºå‡½æ•°
        function log(message, type = 'info') {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '5px';
            logEntry.style.color = type === 'error' ? '#d32f2f' : type === 'success' ? '#388e3c' : '#333';
            logEntry.textContent = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // æ£€æŸ¥æ‰©å±•çŠ¶æ€
        function checkExtension() {
            log('æ­£åœ¨æ£€æŸ¥æ‰©å±•çŠ¶æ€...');

            if (typeof chrome !== 'undefined' && chrome.runtime) {
                log('âœ… Chromeæ‰©å±•APIå¯ç”¨');

                // å°è¯•è·å–æ‰©å±•ä¿¡æ¯
                try {
                    const manifest = chrome.runtime.getManifest();
                    log(`âœ… æ‰©å±•åç§°: ${manifest.name}`);
                    log(`âœ… æ‰©å±•ç‰ˆæœ¬: ${manifest.version}`);
                } catch (error) {
                    log(`âŒ æ— æ³•è·å–æ‰©å±•ä¿¡æ¯: ${error.message}`, 'error');
                }
            } else {
                log('âŒ Chromeæ‰©å±•APIä¸å¯ç”¨', 'error');
            }
        }

        // æ£€æŸ¥æƒé™
        function checkPermissions() {
            log('æ­£åœ¨æ£€æŸ¥æƒé™...');

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                log('âœ… åª’ä½“è®¾å¤‡APIå¯ç”¨');

                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        log('âœ… éº¦å…‹é£æƒé™å·²è·å¾—');
                        // åœæ­¢æµ‹è¯•æµ
                        stream.getTracks().forEach(track => track.stop());
                    })
                    .catch(error => {
                        log(`âŒ éº¦å…‹é£æƒé™é”™è¯¯: ${error.message}`, 'error');
                    });
            } else {
                log('âŒ åª’ä½“è®¾å¤‡APIä¸å¯ç”¨', 'error');
            }
        }

        // æ¸…ç©ºæ§åˆ¶å°
        function clearConsole() {
            document.getElementById('console-output').innerHTML = 'æ§åˆ¶å°å·²æ¸…ç©º...';
            log('æ§åˆ¶å°å·²æ¸…ç©º');
        }

        // æ¨¡æ‹Ÿç„¦ç‚¹äº‹ä»¶
        function simulateFocus() {
            const input = document.getElementById('text1');
            input.focus();
            log('å·²æ¨¡æ‹Ÿè¾“å…¥æ¡†ç„¦ç‚¹äº‹ä»¶');
        }

        // æ¨¡æ‹Ÿå¤±ç„¦äº‹ä»¶
        function simulateBlur() {
            const input = document.getElementById('text1');
            input.blur();
            log('å·²æ¨¡æ‹Ÿè¾“å…¥æ¡†å¤±ç„¦äº‹ä»¶');
        }

        // æµ‹è¯•æ‰€æœ‰è¾“å…¥æ¡†
        function testAllInputs() {
            const inputs = document.querySelectorAll('input, textarea, [contenteditable]');
            log(`æ‰¾åˆ° ${inputs.length} ä¸ªè¾“å…¥æ¡†å…ƒç´ `);

            inputs.forEach((input, index) => {
                log(`è¾“å…¥æ¡† ${index + 1}: ${input.tagName}${input.type ? `[type=${input.type}]` : ''}${input.id ? `#${input.id}` : ''}`);
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('æµ‹è¯•é¡µé¢å·²åŠ è½½å®Œæˆ');
            log('ğŸ’¡ æç¤ºï¼šç‚¹å‡»è¾“å…¥æ¡†åæŸ¥çœ‹æ˜¯å¦å‡ºç°éº¦å…‹é£å›¾æ ‡');

            // ç›‘å¬è¾“å…¥æ¡†äº‹ä»¶
            document.addEventListener('focus', function(e) {
                if (e.target.matches('input, textarea, [contenteditable]')) {
                    log(`è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹: ${e.target.tagName}${e.target.id ? `#${e.target.id}` : ''}`);
                }
            }, true);

            document.addEventListener('blur', function(e) {
                if (e.target.matches('input, textarea, [contenteditable]')) {
                    log(`è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹: ${e.target.tagName}${e.target.id ? `#${e.target.id}` : ''}`);
                }
            }, true);
        });

        // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.onMessage?.addListener((request, sender, sendResponse) => {
                log(`æ”¶åˆ°æ‰©å±•æ¶ˆæ¯: ${JSON.stringify(request)}`);
            });
        }
    </script>
</body>
</html>