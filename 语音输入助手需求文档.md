# 🔊 谷歌插件语音输入助手 需求文档

## 一、项目概述

本项目旨在开发一个**支持火山引擎流式语音识别的浏览器插件**，为用户提供快速、自然的语音输入体验。\
当用户在任意网页的文本框中点击或聚焦时，插件会在输入框右侧自动显示一个麦克风图标，点击后可实时进行语音识别并将结果填充至文本框。

## 二、核心目标

  ----------------------------------------------------------------------------------------
  模块                      功能说明
  ------------------------- --------------------------------------------------------------
  🔹 UI集成                 在任意输入框右侧自动显示麦克风按钮

  🔹 实时语音识别           接入火山引擎实时语音识别API（流式WebSocket接口）

  🔹 即时输出               将识别文本实时输出到文本框

  🔹 安全配置               用户手动输入并本地保存API密钥，不在代码中硬编码

  🔹 兼容性                 支持常见网页文本输入控件（input、textarea、contenteditable）
  ----------------------------------------------------------------------------------------

## 三、功能流程

### 1️⃣ 启动流程

1.  用户打开网页并点击文本框\
2.  插件自动检测焦点元素，右侧出现麦克风按钮\
3.  用户点击按钮 → 调用麦克风权限\
4.  开始录音并建立WebSocket连接

### 2️⃣ 实时识别

1.  将音频流实时发送至火山引擎识别接口\
2.  接收API返回的中间结果与最终识别文本\
3.  实时填充文本框内容

### 3️⃣ 停止识别

1.  用户再次点击按钮或语音输入结束\
2.  停止录音\
3.  关闭WebSocket连接\
4.  状态图标恢复为未录音状态

## 四、系统结构设计

    speech-input-extension/
    │
    ├─ manifest.json        // 插件声明文件
    ├─ background.js        // 后台任务管理（可选）
    ├─ content.js           // 主逻辑：DOM注入 + 语音识别控制
    ├─ popup.html           // 配置页面（用户输入API信息）
    ├─ popup.js             // 配置逻辑脚本
    └─ icons/mic.png        // 图标素材

## 五、功能模块说明

### 1️⃣ manifest.json

-   定义插件权限与入口文件\
-   权限包括：
    -   `microphone`：音频录制权限\
    -   `activeTab`、`scripting`：脚本注入权限

### 2️⃣ content.js

负责网页端核心逻辑：\
- 自动检测文本框焦点\
- 动态注入麦克风图标\
- 建立 WebSocket 连接至火山引擎接口\
- 实时将识别结果回填到文本框中\
- 录音状态切换逻辑

### 3️⃣ popup.html / popup.js

负责插件配置界面：\
- 用户输入火山引擎的 `API Key` 和 `API Secret`\
- 通过 `chrome.storage.local` 安全保存\
- content.js 运行时动态读取

### 4️⃣ background.js

（可选）用于全局管理或后续扩展，如： - 管理多标签页通信\
- 监听权限状态

## 六、API 接入说明

**接口类型：** 火山引擎语音识别 WebSocket 实时流式接口\
**地址示例：**

    wss://openspeech.bytedance.com/ws/v1/stream

**鉴权方式：**\
- 使用 `AccessKeyId` 与 `AccessKeySecret`\
- 根据火山官方文档生成签名（HMAC-SHA256）\
- 插件前端通过动态签名（或由本地中转服务生成）实现安全接入

**返回数据格式：**

``` json
{
  "type": "final_result",
  "text": "这是识别到的文字"
}
```

## 七、安全与隐私设计

  项目              说明
  ----------------- --------------------------------------
  ❌ 硬编码密钥     禁止在源码中写死密钥
  🔒 本地存储       使用 `chrome.storage.local` 加密保存
  🧩 用户自定义     用户在插件弹窗中手动设置 API 信息
  🧼 最小权限原则   仅申请 microphone、activeTab 权限

## 八、UI 设计与交互

  元素            说明
  --------------- --------------------------------
  🎤 麦克风图标   默认状态，未录音
  🛑 红色图标     录音进行中
  🔁 动态提示     根据识别状态实时更新
  📄 文本框填充   实时更新识别文字，无需额外点击

## 九、扩展功能规划

  功能            描述
  --------------- -----------------------------------------
  🎧 自动断句     根据语音停顿自动插入标点
  🌐 多语言支持   支持中文、英文切换
  ⏹️ 自动停止     长时间无语音自动结束识别
  💬 模型选择     支持火山不同语音识别模型（实时/增强版）

## 十、测试要点

  测试项   内容
  -------- --------------------------------------
  权限     检查麦克风授权提示
  兼容性   各类网页输入框适配
  延迟     语音识别延迟控制在 1 秒内
  稳定性   多次启动停止录音无报错
  安全     检查密钥未在源码或网络传输中明文出现

## 十一、交付结果

-   插件源代码文件夹\
-   可导入 Chrome 调试的 `.zip` 包\
-   用户配置文档（如何输入API密钥）\
-   火山引擎签名配置说明（附官方链接）
