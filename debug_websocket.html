<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocketè¿æ¥æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #3367d6;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }
        .log-success { color: #28a745; }
        .log-error { color: #dc3545; }
        .log-info { color: #17a2b8; }
        .log-warning { color: #ffc107; }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-connected { background: #28a745; }
        .status-disconnected { background: #dc3545; }
        .status-connecting { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ WebSocketè¿æ¥æµ‹è¯•å·¥å…·</h1>

        <div class="form-group">
            <label>WebSocket URL:</label>
            <input type="text" id="wsUrl" placeholder="ä¾‹å¦‚: wss://openspeech.bytedance.com/api/v3/sauc/bigmodel"
                   value="wss://openspeech.bytedance.com/api/v3/sauc/bigmodel">
        </div>

        <div class="form-group">
            <label>è®¤è¯å‚æ•° (å¯é€‰):</label>
            <input type="text" id="authParams" placeholder="ä¾‹å¦‚: app_id=123&access_token=abc">
        </div>

        <div class="form-group">
            <label>è¿æ¥è¶…æ—¶ (ç§’):</label>
            <select id="timeout">
                <option value="5">5ç§’</option>
                <option value="10" selected>10ç§’</option>
                <option value="15">15ç§’</option>
                <option value="30">30ç§’</option>
            </select>
        </div>

        <div style="margin-bottom: 20px;">
            <button onclick="testConnection()">ğŸ§ª æµ‹è¯•è¿æ¥</button>
            <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
            <button onclick="generateTestUrls()">ğŸ”¨ ç”Ÿæˆæµ‹è¯•URL</button>
        </div>

        <div class="log-area" id="logArea">
            <div class="log-entry log-info">æ—¥å¿—è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>
    </div>

    <script>
        let ws = null;
        let isConnected = false;

        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;

            let statusIcon = '';
            if (type === 'success') statusIcon = '<span class="status-indicator status-connected"></span>';
            else if (type === 'error') statusIcon = '<span class="status-indicator status-disconnected"></span>';
            else if (type === 'warning') statusIcon = '<span class="status-indicator status-connecting"></span>';

            logEntry.innerHTML = `[${timestamp}] ${statusIcon}${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logArea').innerHTML = '<div class="log-entry log-info">æ—¥å¿—å·²æ¸…ç©º...</div>';
        }

        function generateTestUrls() {
            const urls = [
                {
                    name: 'ç«å±±å¼•æ“åŒå‘æµå¼',
                    url: 'wss://openspeech.bytedance.com/api/v3/sauc/bigmodel',
                    params: 'app_id=7547060066&access_token=lIiI3tsagpi2Ynpm_qwbI1zPkKMctNZO'
                },
                {
                    name: 'ç«å±±å¼•æ“æ ‡å‡†',
                    url: 'wss://openspeech.bytedance.com/ws/v1/stream',
                    params: 'access_key_id=YOUR_KEY&access_key_secret=YOUR_SECRET'
                },
                {
                    name: 'é˜¿é‡Œäº‘',
                    url: 'wss://nls-gateway.cn-shanghai.aliyuncs.com/ws/v1',
                    params: 'appkey=YOUR_APPKEY&token=YOUR_TOKEN'
                },
                {
                    name: 'è…¾è®¯äº‘',
                    url: 'wss://asr.cloud.tencent.com/asr/v2/',
                    params: 'secret_id=YOUR_ID&secret_key=YOUR_KEY'
                },
                {
                    name: 'ç™¾åº¦æ™ºèƒ½äº‘',
                    url: 'wss://vop.baidu.com/realtime_asr',
                    params: 'api_key=YOUR_KEY&secret_key=YOUR_SECRET'
                },
                {
                    name: 'ç§‘å¤§è®¯é£',
                    url: 'wss://iat-api.xfyun.cn/v2/iat',
                    params: 'app_id=YOUR_APPID&api_secret=YOUR_SECRET'
                }
            ];

            let html = '<div class="log-entry log-info">ğŸ”§ ç”Ÿæˆçš„æµ‹è¯•URLåˆ—è¡¨ï¼š</div>';
            urls.forEach(item => {
                html += `<div class="log-entry log-info"><strong>${item.name}:</strong><br>`;
                html += `URL: ${item.url}<br>`;
                html += `å‚æ•°: ${item.params}</div>`;
            });

            document.getElementById('logArea').innerHTML = html;
        }

        async function testConnection() {
            const wsUrlInput = document.getElementById('wsUrl').value.trim();
            const authParamsInput = document.getElementById('authParams').value.trim();
            const timeoutInput = parseInt(document.getElementById('timeout').value) * 1000;

            if (!wsUrlInput) {
                log('è¯·è¾“å…¥WebSocket URL', 'error');
                return;
            }

            const fullUrl = authParamsInput ? `${wsUrlInput}?${authParamsInput}` : wsUrlInput;

            log(`å¼€å§‹æµ‹è¯•è¿æ¥: ${fullUrl}`, 'info');
            log(`è¶…æ—¶æ—¶é—´: ${timeoutInput/1000}ç§’`, 'info');

            try {
                // å…ˆæµ‹è¯•åŸºæœ¬è¿æ¥ï¼ˆä¸å¸¦å‚æ•°ï¼‰
                await testBasicConnection(wsUrlInput, timeoutInput);

                // å¦‚æœæœ‰å‚æ•°ï¼Œå†æµ‹è¯•å¸¦å‚æ•°çš„å®Œæ•´è¿æ¥
                if (authParamsInput) {
                    log('å¼€å§‹æµ‹è¯•å¸¦å‚æ•°çš„å®Œæ•´è¿æ¥...', 'info');
                    await testFullConnection(fullUrl, timeoutInput);
                }

            } catch (error) {
                log(`æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testBasicConnection(url, timeout) {
            return new Promise((resolve, reject) => {
                log(`æµ‹è¯•åŸºç¡€è¿æ¥: ${url}`, 'info');

                const ws = new WebSocket(url);
                const timeoutId = setTimeout(() => {
                    ws.close();
                    reject(new Error('è¿æ¥è¶…æ—¶'));
                }, timeout);

                ws.onopen = () => {
                    clearTimeout(timeoutId);
                    log('âœ… åŸºç¡€è¿æ¥æˆåŠŸï¼', 'success');
                    ws.close();
                    resolve();
                };

                ws.onerror = (error) => {
                    clearTimeout(timeoutId);
                    log(`âŒ åŸºç¡€è¿æ¥å¤±è´¥: ${error.type}`, 'error');
                    reject(new Error('åŸºç¡€è¿æ¥å¤±è´¥'));
                };

                ws.onclose = (event) => {
                    log(`è¿æ¥å…³é—­ - ä»£ç : ${event.code}, åŸå› : ${event.reason}`, 'info');
                };
            });
        }

        function testFullConnection(url, timeout) {
            return new Promise((resolve, reject) => {
                log(`æµ‹è¯•å®Œæ•´è¿æ¥: ${url}`, 'info');

                const ws = new WebSocket(url);
                const timeoutId = setTimeout(() => {
                    ws.close();
                    reject(new Error('å®Œæ•´è¿æ¥è¶…æ—¶'));
                }, timeout);

                ws.onopen = () => {
                    clearTimeout(timeoutId);
                    log('âœ… å®Œæ•´è¿æ¥æˆåŠŸï¼', 'success');

                    // å‘é€æµ‹è¯•æ•°æ®
                    try {
                        ws.send(JSON.stringify({
                            type: 'test',
                            timestamp: Date.now()
                        }));
                        log('ğŸ“¤ å·²å‘é€æµ‹è¯•æ•°æ®', 'info');
                    } catch (e) {
                        log(`å‘é€æ•°æ®å¤±è´¥: ${e.message}`, 'warning');
                    }

                    setTimeout(() => {
                        ws.close();
                        resolve();
                    }, 2000);
                };

                ws.onmessage = (event) => {
                    log(`ğŸ“¥ æ”¶åˆ°æ¶ˆæ¯: ${event.data}`, 'success');
                };

                ws.onerror = (error) => {
                    clearTimeout(timeoutId);
                    log(`âŒ å®Œæ•´è¿æ¥å¤±è´¥: ${error.type}`, 'error');
                    reject(new Error('å®Œæ•´è¿æ¥å¤±è´¥'));
                };

                ws.onclose = (event) => {
                    log(`è¿æ¥å…³é—­ - ä»£ç : ${event.code}, åŸå› : ${event.reason || 'æœªçŸ¥'}`, 'info');
                };
            });
        }

        // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆä¸€äº›æµ‹è¯•URL
        window.onload = function() {
            setTimeout(() => {
                log('ğŸš€ WebSocketæµ‹è¯•å·¥å…·å·²åŠ è½½', 'info');
                log('ğŸ’¡ æç¤ºï¼šå¯ä»¥å…ˆç‚¹å‡»"ç”Ÿæˆæµ‹è¯•URL"æŸ¥çœ‹å„ç§è¯­éŸ³è¯†åˆ«æœåŠ¡çš„æ¥å£åœ°å€', 'info');
            }, 100);
        };
    </script>
</body>
</html>